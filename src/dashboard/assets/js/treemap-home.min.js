/*
 =========================================================
 esg:one Dashboard Application
 =========================================================
 @license Copyright 2021 Beathamm Ltd (https://esg-one.co)
 @author  22 Digital Ltd (https://22digital.ltd)
 @author  Justin Hartman <code@22digital.ltd>
*/
d3.json("/dashboard/assets/data/treemap.json",function(v){function w(b){b.x=b.y=0;b.x1=d;b.y1=450;b.depth=0}function p(b){return(b._children=b.children)?b.value=b.children.reduce(function(a,b){return a+p(b)},0):b.value}function q(b){b._children&&b._children.forEach(function(a){a.x0=b.x0+a.x0*b.x1;a.y0=b.y0+a.y0*b.y1;a.x1*=b.x1;a.y1*=b.y1;a.parent=b;q(a)})}function r(b){function a(a){if(!m&&a){m=!0;var b=r(a),l=d.transition().duration(750),e=b.transition().duration(750);c.domain([a.x0,a.x0+a.x1]);
g.domain([a.y0,a.y0+a.y1]);f.style("shape-rendering",null);f.selectAll(".depth").sort(function(a,b){return a.depth-b.depth});b.selectAll("text").style("fill-opacity",0);l.selectAll("text").call(n).style("fill-opacity",0);e.selectAll("text").call(n).style("fill-opacity",1);l.selectAll("rect").call(h);e.selectAll("rect").call(h);l.remove().on("end",function(){f.style("shape-rendering","crispEdges");m=!1})}}k.datum(b.parent).on("click",a).select("text").text(t(b));var d=f.insert("g",".grandparent").datum(b).attr("class",
"depth");b=d.selectAll("g").data(b._children).enter().append("g");b.filter(function(a){return a._children}).classed("children",!0).on("click",a);var e=b.selectAll(".child").data(function(a){return a._children||[a]}).enter().append("g");e.append("rect").attr("class","child").call(h).append("title").text(function(a){return a.data.shortName+" ("+x(a.value)+")"});e.append("text").attr("class","ctext").style("font-size","12px").style("font-weight","normal").text(function(a){return a.data.shortName}).call(y);
b.append("rect").attr("class","parent").call(h);e=b.append("text").attr("class","ptext").attr("dx","0.2em");e.append("tspan").attr("dy","0.5em").style("font-weight","normal").style("font-size","12px").style("fill","#f2f2f2").text(function(a){return a.data.shortName});e.append("tspan").attr("dy","1.2em").attr("dx","0.3em").style("fill","#f2f2f2").style("font-size","12px").style("font-weight","normal").text(function(a){return a.data.metric?a.data.size+" "+a.data.metric:a.data.size});e.call(n);b.selectAll("rect").style("fill",
function(a){return z(a.data.shortName)});return b}function n(b){b.selectAll("tspan").attr("x",function(a){return c(a.x0)+6});b.attr("x",function(a){return c(a.x0)+6}).attr("y",function(a){a=g(a.y0);return 0===a?40:390>a?a+15:a+35}).style("fill","transparent").style("opacity",function(a){return this.getComputedTextLength()<c(a.x0+a.x1)-c(a.x0)?1:0})}function y(b){b.attr("x",function(a){return c(a.x0+a.x1)-this.getComputedTextLength()-6}).attr("y",function(a){return g(a.y0+a.y1)}).style("opacity",function(a){return this.getComputedTextLength()<
c(a.x0+a.x1)-c(a.x0)?0:1})}function h(b){b.attr("x",function(a){return c(a.x0)}).attr("y",function(a){return g(a.y0)}).attr("width",function(a){return c(a.x0+a.x1)-c(a.x0)}).attr("height",function(a){return g(a.y0+a.y1)-g(a.y0)})}function t(b){return b.parent?t(b.parent)+" / "+b.data.shortName+" ("+b.data.size+"%)":b.data.shortName}var d=$("#card").width(),x=d3.format(",d"),m,c=d3.scaleLinear().domain([0,d]).range([0,d]),g=d3.scaleLinear().domain([0,450]).range([0,450]),z=d3.scaleOrdinal().range(d3.schemeCategory10.map(function(b){return b=
d3.rgb(b)}));d3.format(",d");var u,f,k;(function(){f?f.selectAll("*").remove():(f=d3.select("#domainDrillDown").append("svg").attr("width",d-0-0).attr("height",450).style("border-radius","5px").style("margin-left","0px").style("margin.right","0px").append("g").attr("transform","translate(0,0)").style("shape-rendering","crispEdges"),k=f.append("g").attr("class","grandparent"),k.append("rect").attr("y",-0).attr("x",0).attr("width",d+1).attr("height",25),k.append("text").style("font-size","12px").style("font-weight",
"bold").attr("x",6).attr("y",6).attr("dy",".80em"),u=d3.treemap().size([d,450]).round(!1).paddingInner(1));var b=d3.hierarchy(v).eachBefore(function(a){a.id=(a.parent?a.parent.id+".":"")+a.data.shortName}).sum(function(a){return a.size}).sort(function(a,b){return b.height-a.height||b.value-a.value});w(b);p(b);q(b);u(b);r(b)})()});
