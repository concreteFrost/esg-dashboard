$('#expand-treemap-btn').click(() => {
  $('#_treemap').toggleClass('col-12');
  $('#_treemap').toggleClass('col-xl-6');
});

$.getJSON('/dashboard/assets/data/treemap.json', (data) => {
  chart = anychart.treeMap(data, 'as-tree');
  // set the container id
  chart.container('domainDrillDown');
  // set the maximum depth of levels shown
  chart.maxDepth(2);
  // set the depth of hints
  chart.hintDepth(1);
  // set the opacity of hints
  chart.hintOpacity(0.5);
  var customColorScale = anychart.scales.linearColor();
  customColorScale.colors(['#B9EBEB', '#028FE0']);
  chart.headers().fontWeight('bold');

  chart.headers().background('#1ba2c1');
  chart.headers().fontColor('white');

  chart.tooltip().format(function () {
    return (
      this.oc.kg.ka.value +
      '% of 100 required policies and processes are currently in place'
    );
  });

  chart.labels().format(function () {

    return this.name + ' ' + this.oc.kg.ka.value + '%';
  });
  // add a color range
  chart.listen('drillchange', function (e) {
    PopulateTable(e,2) 
  });
  chart.draw();
});

function PopulateTable(e, num){
 
  $('#gaps-title').html(e.current.node.ka.name);
  $('#gaps-body').empty();
    $('.missing-data-mock').hide()
    $('.missing-data-gaps').removeClass("d-none")
    e.current.node.b.forEach((n) => {
    var tableData = `<tr><td  class="font-weight-bold">${n.ka.name} </td>
    <td>${n.ka.value}</td>
    ${!location.pathname.includes('esg-management') ? `<td >${n.ka.size} <button class="btn btn-sm btn-primary ml-3" onClick={$('#tableModal').modal('show')}>view</button></td>` : null}
    </tr>`;
      $('#gaps-body').append(tableData);
    });
}

$('.default-view').click(()=>{
  $('.missing-data-mock').show()
  $('.missing-data-gaps').addClass("d-none")
})
