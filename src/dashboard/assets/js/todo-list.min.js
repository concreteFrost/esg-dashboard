//Get all tasks on start
$(document).ready(() => {
  getItems();
  hideMessage();
  makeListSortable();
});

//Submit task
$('#submit-todo-btn').click(() => {
  const msg = $('#todoText').val();
  const framework = $('#frameworks-val').val();
  var id = Math.random().toString(16).slice(2);
  const el = `<li
    class="checklist-entry list-group-item flex-column align-items-start py-4 px-4"
  >
    <div class="checklist-item checklist-item-esg-esg-three">
      <div class="checklist-info">
        <h5 class="checklist-title mb-0">
          ${msg}
        </h5>
        <small>${framework}</small>
      </div>
      <div>
        <div
          class="custom-control custom-checkbox custom-checkbox-esg-three"
        >
          <input
            class="custom-control-input"
            id="${id}"
            type="checkbox"
            value="done"
            onclick="decorateText(this)"
          />
          <label
            class="custom-control-label"
            for="${id}"
          >done</label>   
        </div>
        <div>
        <button class ="btn btn-danger btn-sm float-right" onclick="deleteTask(this)">delete task</button>
        </div>
      </div>
    </div>
  </li>`;
  if (msg.length > 0) {
    $('#todo-list').append(el);
    $('#todoModal').modal('hide');
    $('#empty-msg-error').addClass('d-none');
    $('#todoText').val('');
    setItems();
    hideMessage();
    makeListSortable();
  } else {
    $('#empty-msg-error').removeClass('d-none');
  }
});

//Reusable get
function getItems() {
  
  if (localStorage.getItem('todo-items') !== null) {
    var allItems = localStorage.getItem('todo-items');
    var stripped = allItems.replace(/,(?!["{}[\]])/g, '');
    $('#todo-list').html(stripped);
  }
}

//Reusable set
function setItems() {
  localStorage.setItem('todo-items', $('#todo-list').html());
}

//Hide default message
function hideMessage() {
  if ($('#todo-list li').length > 0) {
    $('#default-todo').hide();
  }
}

//Clear All tasks
$('#clear-all-tasks-btn').click(() => {
  $('#todo-list li').remove();
  $('#default-todo').show();
  setItems();
});

//Cross text on checkbox click
const decorateText = (e) => {
  if ($(e).is(':checked')) {
    $(e).closest('li').find('h5').css('text-decoration', 'line-through');
    $(e).closest('li').find('small').css('text-decoration', 'line-through');
    $(e).attr('checked', true);
  } else {
    $(e).closest('li').find('h5').css('text-decoration', 'none');
    $(e).closest('li').find('small').css('text-decoration', 'none');
    $(e).attr('checked', false);
  }
  setItems();
};

const deleteTask = (e) => {
  $(e).closest('li').remove();
  if ($('#todo-list li').length === 0) {
    $('#default-todo').show();
  }
  makeListSortable();
  setItems();
};

function makeListSortable() {
  
    $('#todo-list').sortable();
  
  
}
