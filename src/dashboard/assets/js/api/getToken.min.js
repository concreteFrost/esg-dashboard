//This setup is related to the old endpoints
var setup = $.ajaxSetup({
  url: 'https://europe.grc1.com/iGRC/Auth/token',
  method: 'POST',
  data: {
    username: 'rich@esg-one.co',
    password: 'Temp5678',
    grant_type: 'password',
  },
});

//Used for new endpoints
$(document).ready(() => {

  const token = localStorage.getItem('access_token');
  const expires_in = localStorage.getItem('expires_in');
  console.log(token)
  if (!token || token && new Date().toLocaleString() > transformExpiresIn(expires_in)) {
    $.ajax(
      {
        url: "https://data.esg-one.uk/esg1-api/token",
        method: "POST",
        data: {
          username: "esgapiadmin",
          password: "JGzAunUj&K81",
          grant_type: "password"
        },
        success: function (data) {
          alert('new token was granted');
          console.log("new token", data)
          localStorage.setItem('access_token', data.access_token);
          localStorage.setItem('expires_in', data.expires_in);
        },
        error: function (e) {
          console.log(e)
        }
      }
    )
  }

})

function transformExpiresIn(expires_in) {
  var expirationTime = new Date().getTime() + expires_in * 1000;
  return new Date(expirationTime).toLocaleString();
}

