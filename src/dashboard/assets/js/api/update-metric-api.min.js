$('#editMetricModal').on('shown.bs.modal', () => {

  $.ajax({
    url: 'https://europe.grc1.com/iGRC/Auth/token',
    method: 'POST',
    data: {
      username: 'rich.interface@esg1.com',
      password: 'Temp5678',
      grant_type: 'password',
    },

    success: function (data) {
      console.log($('#update-metric-last-review-data').val().toString()+"T00:00:00")
      $.ajax({
        url:
          'https://europe.grc1.com/iGRC/api/Metric/GetById?metricId=' +
          localStorage.getItem('metric id'),
        method: 'GET',
        headers: {
          Authorization: 'BEARER ' + data.access_token,
        },
        success: function (d2) {
          console.log(d2);

          d2.IsActive === 'Y'
            ? $('#update-metric-is-active').prop('checked', true)
            : $('#update-metric-is-active').prop('checked', false);

          $('#update-metric-company').val(d2.Company)
          $('#update-metric-name').val(d2.Name)
          $('#update-metric-description').val(d2.Description);

          $('#update-metric-type').val(d2.Type)
          $('#update-metric-office').val(d2.Office)
          $('#update-metric-unit').val(d2.BusinessUnit)
          $('#update-metric-category').val(d2.Category)
          $('#update-metric-importance').val(d2.Importance)
          $('#update-metric-current-value').val(d2.CurrentValue)
          $('#update-metric-upper-limit').val(d2.UpperLimitValue)
          $('#update-metric-lower-limit').val(d2.LowerLimitValue)
          $('#update-metric-target').val(d2.TargetValue)
          $('#update-industry-benchmark').val(d2.IndustryBenchmark);
          $('#update-metric-last-review-data').val(d2.LastReviewDate !== null ? d2.LastReviewDate.split('T')[0] : 'null')
          $('#update-metric-next-review-data').val(d2.NextReviewDate !== null ? d2.NextReviewDate.split('T')[0] : 'null')

        },
        error: function (e) {
          console.log('error');
        },
      });
    },
    error: function (e) {
      console.log(e);
    },
  });

});

$('#update-metric-btn').on('click', () => {
  $.ajax({
    url: 'https://europe.grc1.com/iGRC/Auth/token',
    method: 'POST',
    data: {
      username: 'rich.interface@esg1.com',
      password: 'Temp5678',
      grant_type: 'password',
    },

    success: function (data) {
      
      $.ajax({
        url:
          'https://europe.grc1.com/iGRC/api/Metric/UpdateMetric?metricId=' +
          localStorage.getItem('metric id'),
        method: 'PUT',
        headers: {
          Authorization: 'BEARER ' + data.access_token,
        },
        data: {
          "IsActive" : "n",
          "Company": $('#update-metric-company').val(),
          "Office": $('#update-metric-office').val(),
          "BusinessUnit": $('#update-metric-unit').val(),
          "Type": $('#update-metric-type').val(),
          "Name": $('#update-metric-name').val(),
          "Description": $('#update-metric-description').val(),
          "Importance": $('#update-metric-importance').val(),
          "Category": $('#update-metric-category').val(),
          "Subcategory": "null",
          "OwnerEmail": "steve@esg-one.co",
          "Owner" : "ESG Support",
          "ExecutiveOwnerEmail": "steve@esg-one.co",
          "LimitType": $('#update-metric-limit').val(),
          "CurrentValue": $('#update-metric-current-value').val(),
          "UpperLimitValue": $('#update-metric-upper-limit').val(),
          "LowerLimitValue": $('#update-metric-lower-limit').val(),
          "TargetValue": $('#update-metric-target').val(),
          "IndustryBenchmark": $('#update-industry-benchmark').val(),
          "LastReviewDate": $('#update-metric-last-review-data').val() + 'T00:00:00',
          "NextReviewDate": $('#update-metric-next-review-data').val() + 'T00:00:00',
          "CreateIncidentIfBreached": true,
          "ReportToEmail": [
            "string"
          ]
        },

        success: function (d2) {

          dt.id.draw()
          $.ajax({
            setup,
            success: function (data) {
              getMetric(data);
              $('#editMetricModal').modal('hide')
              $('#metric-updated-modal').modal('show')
            },
          });
        },
        error: function (e) {
          console.log(e.responseText);
        },
      });
    },
    error: function (e) {
      console.log(e);
    },
  });
})

$('#metric-updated-modal').on('shown.bs.modal', () => {
  setTimeout(function () {
    $('#metric-updated-modal').modal('hide');
  }, 3000);
})

