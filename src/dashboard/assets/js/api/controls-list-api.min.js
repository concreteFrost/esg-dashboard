

  $.ajax({ setup,
    success: function (data) {
      getControls(data)
    },
    error: function (e) {
      console.log(e);
    },
  });

function getControls(data){
  $.ajax({
    url: 'https://europe.grc1.com/iGRC/api/Control/Get',
    async: true,
    crossDomain: true,
    method: 'GET',
    data: {
      tenantName: 'ESG-ONE',
    },
    beforeSend: function (xhr) {
      xhr.setRequestHeader('Authorization', 'Bearer ' + data.access_token);
    },

    success: function (data2) {
      const controlsArr = data2;

      controlsArr.forEach((c) => {
        const el = `<tr>
        <td>${c.ControlNumber}</td>
        <td><a href="/dashboard/company/individual-control.html" onclick="redirectToRisk(this)" data-id=${
          c.ControlId
        }> ${c.ControlName} </a></td>
        <td>${c.Office.OfficeName}</td>
       
        <td>${c.Owner.FullName}</td>
        <td>${c.BusinessUnit.BusinessUnitName}</td>
        <td>${c.ControlCategory.ControlCategoryName}</td>
       
        <td>${c.RequiredByRegulator}</td>
   
        <td>${c.LastReviewDate.split('T')[0]}</td>
        <td>${c.NextReviewDate.split('T')[0]}</td>
        <td><button class="btn btn-danger btn-sm">delete</button></td>
        </tr>`;

        $('#controls-table-body').append(el);
      });

      createTable("#controls-datatable")
    
    },
    error: function (e) {},
  });
}

function redirectToControls(e) {
  localStorage.setItem('controls id', $(e).data('id'));
}
