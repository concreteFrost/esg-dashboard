var dt = new DT('#metrics-datatable');

$.ajax({
  setup,
  success: function (data) {
    getMetric(data);
  },

});

//Get All
function getMetric(data) {
  $.ajax({
    url: 'https://europe.grc1.com/iGRC/api/Metric/Get',
    method: 'GET',
    data: {
      tenantName: 'ESG-ONE',
    },
    headers: {
      Authorization: 'Bearer ' + data.access_token,
    },

    success: function (data2) {

      dt.id.clear()
      $('.api-loader').addClass('d-none')
      const metricArr = data2;
      console.log(metricArr)
      metricArr.forEach((metric) => {
        dt.id.row.add([
          `<a href="/dashboard/company/individual-metric.html#overview" onclick="redirectToMetric(this)" data-id=${metric.MetricId
          }> ${metric.Name} </a></td>`,
          metric.CurrentValue,
          metric.TargetValue > 0 ? metric.TargetValue - metric.CurrentValue : 'N/A',
          metric.Type,
          metric.Category,
          metric.Subcategory === null ? '-' : metric.Subcategory,
          `<button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editMetricModal" onclick="redirectToMetric(this)" data-id=${metric.MetricId
          }>edit</button>
                        <button class="btn btn-danger btn-sm" onclick="performDeletion(this)" data-id="${metric.MetricId
          }">delete</button>`
        ])
      });

      dt.id.draw()

    },
  });
}

//Delete Metric By Id
function performDeletion(e) {
  $(e).closest('tr').remove();
}

//Create Table
function redirectToMetric(e) {
  localStorage.setItem('metric id', $(e).data('id'));
  console.log(localStorage.getItem('metric id'));
}
