$(document).ready(() => {
  if (location.pathname.endsWith('risk-overview.html')) {
    $('#risks-view-all').hide();
    $('#risks').removeClass('col-xl-6');
  }
});


$.ajax({
  setup,
  success: function (data) {
    getRisk(data);
  },
  error: function (e) {
    console.log(e);
  },
});

function getRisk(data) {
  $.ajax({
    url: 'https://europe.grc1.com/iGRC/api/Risk/Get',
    async: true,
    crossDomain: true,
    method: 'GET',
    data: {
      tenantName: 'ESG-ONE',
    },
    beforeSend: function (xhr) {
      xhr.setRequestHeader('Authorization', 'Bearer ' + data.access_token);
    },

    success: function (data2) {
      const riskArr = data2;
      console.log(riskArr);
      riskArr.forEach((risk) => {
        var riskCategory = '';
        if (risk.RiskCategory && risk.RiskCategory.RiskCategoryName) {
          riskCategory = risk.RiskCategory.RiskCategoryName;
        }
        const el = `<tr>
                    <td>${risk.RiskNumber}</td>
                    <td><a href="/dashboard/company/individual-risk.html" onclick="redirectToRisk(this)" data-id=${
                      risk.RiskId
                    }> ${risk.RiskName} </a></td>
                    <td>${risk.RiskType.NewMnemonic}</td>
                    <td>${risk.RiskOwner.FullName}</td>
                    <td>${risk.Office.OfficeName}</td>
                    <td>${riskCategory === '' ? 'null' : riskCategory}</td>
                    <td>${risk.RegisterPreScore}</td>
                    <td>${risk.RegisterCurrentScore}</td>
                    <td>${risk.RegisterTargetImpactScore}</td>
                    <td>${risk.RegisterTrendScore}</td>
                    <td>${risk.Proximity.ProximityName}</td>
                    <td>${risk.LinkedControlNumbers}</td>
                    <td>${risk.LastReviewDate.split('T')[0]}</td>
                    <td>${risk.NextReviewDate.split('T')[0]}</td>
                    <td><button class="btn btn-danger btn-sm">delete</button></td>
                    </tr>`;

        $('#risk-table-body').append(el);
      });
      createTable("#risk-datatable");
    },
  });
}


function redirectToRisk(e) {
  localStorage.setItem('risk id', $(e).data('id'));
}
