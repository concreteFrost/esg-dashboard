$.ajax({
  setup,
  success: function (data) {
    getRisk(data);
  },
});

function getRisk(data) {
  console.log(data);
  $.ajax({
    url:
      'https://europe.grc1.com/iGRC/api/Risk/GetById_Summary?riskId=' +
      localStorage.getItem('risk id'),
    method: 'GET',
    headers: {
      Authorization: 'BEARER ' + data.access_token,
    },
    success: function (data2) {
      var r = data2;
      //Shared values
      getSharedValues(r)
      //Overview Page
      getOverviewValues(r);
      //Scoring Page
      getScoringValues(r);
      //Impacts Page
      getImpactValues(r)
    },
    error: function (e) {
      console.log('error');
    },
  });
}

//Shared Values
function getSharedValues(r){
  $('.api-loader').hide();
  $('.risk-name').html(r.RiskName);
  $('.risk-office').html(r.Office);
  $('.risk-consequence').html(
    r.Consequence ? r.Consequence : '-------------'
  );
}

//Overview Page
function getOverviewValues(r) {
  $('#risk-business-unit').html(r.BusinessUnit);
  $('#risk-category').html(r.RiskCategory);
  $('#risk-subcategory').html(r.RiskSubcategory);
  $('#risk-description').html(r.RiskDescription);
  // $('#individual-risk-priority').html(r.RegisterCurrentScore);

  $('#proximity').html(r.Proximity);
  $('#risk-owner-name').html(r.OwnerName);
  $('#score-update').html(r.LastResidualRiskScoreUpdate.split('T')[0]);
  $('#score-last-review-date').html(r.LastReviewDate.split('T')[0]);
  $('#score-next-review-date').html(r.NewReviewDate);

  //Table Values
  $('#individual-risk-score').html(r.RegisterCurrentScore);
  $('#individual-risk-target').html(r.TargetScore);
  $('#individual-risk-exposure').html(
    r.ResidualFinancialExposure ? r.ResidualFinancialExposure : '-'
  );
  $('#individual-risk-appetite').html(r.RiskAppetite ? r.RiskAppetite : '-');
  $('#individual-risk-proximity').html(r.Proximity);
  $('#individual-risk-business-trend').html(
    r.BusinessTrend ? r.BusinessTrend : '-'
  );
}

//Scoring Page
function getScoringValues(r) {
  //Scoring Calc
  $('#scoring-pre-metigation-calc').html(
    `<span class="number-in-circle-red">${r.RegisterPreImpactScore}</span> 
        X 
        <span class="number-in-circle-red">${r.RegisterPreLikelihoodScore}</span> 
        = 
        <span class="number-in-circle-red">${r.RegisterPreScore}</span>`
  );
  $('#scoring-current-score-calc').html(
    `<span class="number-in-circle-red">${r.RegisterCurrentImpactScore}</span>
          X 
         <span class="number-in-circle-red">${r.RegisterCurrentLikelihoodScore}</span> 
          =
          <span class="number-in-circle-red">${r.RegisterCurrentScore}</span>`
  );
  $('#scoring-target-score-calc').html(
    `<span class="number-in-circle-yellow">${r.RegisterTargetImpactScore}</span> 
           X 
           <span class="number-in-circle-red">${r.RegisterTargetLikelihoodScore}</span>
          = 
          <span class="number-in-circle-yellow">${r.RegisterTargetScore}</span>`
  );
}

//Impact Page
function getImpactValues(r){
  $('#impact-type').html(r.ImpactType ? r.ImpactType : 'none');
}
