var flag;
var latlng;
var country_name;

var VectorMap = new jvm.Map({
  container: $("#world-map"),
  map: 'world_mill',
  zoomOnScroll: true,
  normalizeFunction: 'polynomial',
  hoverOpacity: 1,
  hoverColor: !1,
  backgroundColor: 'transparent',
  regionStyle: {
    initial: {
      fill: '#dae9f7',
      
    },
    hover: { fill: '#1864AD', 'fill-opacity': 0.8, cursor: 'pointer' },
    selected: { fill: '#0C4E9D' },
    selectedHover: { fill: '#1864AD' },
  },
  markerStyle: {
    initial: { fill: '#F49986', 'stroke-width': 0 },
    hover: { fill: '#0C4E9D', 'stroke-width': 0 },
  },
  markers: [
    { latLng: [37.09024, -95.712891], name: 'United States' },
    { latLng: [55.378052, -3.435973], name: 'United Kingdom' },
    { latLng: [20.593683, 78.962883], name: 'India' },
  ],
  series: {
    regions: [
      {
        values: {
          GB: 1600,
          IN: 150,
          US: 200,
        }, 
        scale: ['#C8EEFF', '#0071A4'],
        normalizeFunction: 'polynomial',
      },
    ],
    size: {
      height: 300,
      width: 1600,
    },
  },
})

$(document).find('.jvectormap-zoomin').addClass('btn btn-sm btn-primary');
$(document).find('.jvectormap-zoomout').addClass('btn btn-sm btn-primary');

$('#locationsModalCenter').on('shown.bs.modal', () => {
  $.ajax({
    url: 'https://restcountries.com/v3.1/all',
    method: 'GET',

    success: function (data) {
      $('#new-location').empty();
      data.sort(function (a, b) {
        var name1 = a.name.common.toUpperCase();
        var name2 = b.name.common.toUpperCase();
        return name1 < name2 ? -1 : name1 > name2 ? 1 : 0;
      });
      data.forEach((element) => {
        let name = element.name.common;
        let cca2 = element.cca2;
        $('#new-location').append(`<option value=${cca2}>${name}</option>`);
      });
    },
    error: function (e) {
      console.log(e);
    },
  });
});


$('#new-location').change(() => {
  $.ajax({
    url: 'https://restcountries.com/v2/alpha/' + $('#new-location').val(),
    method: 'GET',

    success: function (data) {
      flag = data.flags.png;
      latlng = data.latlng;
    },
    error: function (e) {
      console.log('error');
    },
  });
});

$('#save-new-location-btn').click(() => {
  var obj={}
  obj[$('#new-location').val()] = $("#branches").val()
  VectorMap.addMarker($('#new-location option:selected').text(), latlng)
  VectorMap.series.regions[0].setValues(obj)

  var content = `<li class="list-group-item px-0">
  <div class="row align-items-center">
    <div class="col-auto">
      <!-- Country flag -->
      <img
        class="flags"
        src="${flag}"
      />
    </div>
    <div class="col">
      <small>Country</small>
      <h5 class="mb-0">${$('#new-location option:selected').text()}</h5>
    </div>
    <div class="col">
      <small>Branches</small>
      <h5 class="mb-0">${$("#branches").val()}</h5>
    </div>
    <div class="col">
      <small>Perform. vs Mean</small>
      <h5 class="mb-0 text-danger">-</h5>
    </div>
  </div>
</li>`

$('#locations-list').append(content)

});
